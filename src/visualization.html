<!DOCTYPE html>
<html>
<head>
  <title>RDF Graph Visualization</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <style type="text/css">
    #mynetwork {
      width: 100%;
      height: 100%;
      border: 1px solid lightgray;
    }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <div id="mynetwork"></div>
  <div style="position: absolute; top: 20px; right: 20px; z-index: 1000;">
    <input type="file" id="fileInput" accept=".json,.jsonld" style="display: none;" />
    <button onclick="document.getElementById('fileInput').click()" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Load JSON-LD File
    </button>
  </div>
  <script type="text/javascript">
    const nodes = new vis.DataSet([]);
    const edges = new vis.DataSet([]);
    const container = document.getElementById('mynetwork');
    const data = { nodes: nodes, edges: edges };
    const options = {
      nodes: { shape: 'dot', size: 15, font: { size: 14 } },
      edges: { font: { size: 14, align: 'middle' }, color: 'gray', arrows: { to: true }, smooth: false, width: 2 },
      physics: { enabled: true, barnesHut: { gravitationalConstant: -2000, centralGravity: 0.3, springLength: 95, springConstant: 0.04 }, minVelocity: 0.75 }
    };
    const network = new vis.Network(container, data, options);

    document.getElementById('fileInput').addEventListener('change', async function(event) {
      const file = event.target.files[0];
      if (file) {
        try {
          const text = await file.text();
          const response = await fetch('/upload', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: text });
          const result = await response.json();
          if (!result.success) alert('Error loading file: ' + result.error);
        } catch (error) {
          console.error('Error:', error);
          alert('Error loading file');
        }
      }
    });

    const socket = io('http://localhost:${this.port}');
    socket.on('connect', () => socket.emit('requestGraph'));
    socket.on('graphData', function(data) {
      nodes.clear();
      edges.clear();
      nodes.add(data.nodes);
      edges.add(data.edges);
      network.fit();
    });
  </script>
</body>
</html>